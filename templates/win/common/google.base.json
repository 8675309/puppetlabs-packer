{
  "variables": {
 
    "gce_network"         : "default",
    "gce_zone"            : "us-central1-a",
    "gce_project_id"      : "appveyor-images",
    "gce_account_file"    : "{{env `PACKER_GCE_ACCOUNT_FILE`}}",

    "winrm_username"      : "packer_admin"

  },

  "description": "Builds a Windows base template VM for use in VMware",

  "_comment": [
      ""
  ],
  "builders": [{
    "type"                : "googlecompute",
    "image_name"          : "packer-test-image",
    "network"             : "{{user `gce_network`}}",
    "zone"                : "{{user `gce_zone`}}",
    "account_file"        : "{{user `gce_account_file`}}",
    "project_id"          : "{{user `gce_project_id`}}",
    "source_image_family" : "{{user `gce_source_image_family`}}",
    "disk_size"           : "50",
    "machine_type"        : "{{user `gce_machine_type`}}",
    "communicator"        : "winrm",
    "winrm_username"      : "{{user `winrm_username`}}",
    "winrm_insecure"      : true,
    "winrm_use_ssl"       : true,
    "omit_external_ip"    : false,
    "metadata": {
      "windows-startup-script-cmd": "winrm quickconfig -quiet & net localgroup administrators {{user `winrm_username`}} /add & winrm set winrm/config/service/auth @{Basic=\"true\"}"
    }
  }
  ],
  "provisioners": [
    {
      "type": "powershell",
      "environment_vars" : [
        "foo=Bar",
        "Mumble=Flame"
      ],
      "inline": [
        "Write-Output 'Hello World'",
        "Write-Output 'WinRMConfig: {{ .Winrmconfig}}'",
        "Write-Output 'Vars: {{.Vars}}'",
        "Write-Output 'Name: {{.Name}}'",
        "Write-Output 'project: {{user `gce_project_id`}}'",
        "Write-Output 'Build Name: {{build_name}}'",
        "Write-Output 'Path: {{.Path}}'"
      ]
    }
  ]
}
